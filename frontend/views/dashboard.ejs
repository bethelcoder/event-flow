<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Staff Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <link rel="stylesheet" href="/styles/staff-dashboard.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>

<section class="line-container">

  <!-- ============== ALPHA (Sidebar) ============== -->
  <section class="alpha" id="alpha">
    <h2 class="alpha-header">Staff Dashboard</h2>
    <nav class="alpha-buttons">
      <a href="#" class="alpha-btn" data-page="/team-chats">
        <i class="fa-solid fa-message"></i> Team Chats
      </a>
      <a href="#" class="alpha-btn" data-page="/announcements">
        <i class="fas fa-bell"></i> Announcements
      </a>
      <a href="#" class="alpha-btn" data-page="/report-incident">
        <i class="fas fa-triangle-exclamation"></i> Report Incident
      </a>
      <a href="#" class="alpha-btn" data-page="/my-tasks">
        <i class="fas fa-clipboard-check"></i> My Tasks
      </a>
    </nav>
  </section>

  <!-- ============== BETA (Top Navbar) ============== -->
  <section class="beta" id="beta">
    <!-- Left: hamburger -->
    <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
      <i class="fa-solid fa-bars"></i>
    </button>

    <!-- Center: title -->
    <h1 class="beta-title">Eventflow</h1>

    <!-- Right: portal name -->
    <p class="beta-right">STAFF PORTAL</p>
  </section>

  <!-- ============== OMEGA (Main Content Area) ============== -->
  <section class="omega" id="omega">
    <div id="omega-content" class="omega-scroll">
      <%- include('team-chats') %>
    </div>
  </section>

</section>

<script>
  const alpha = document.getElementById('alpha');
  const menuToggle = document.getElementById('menu-toggle');
  const omegaContent = document.getElementById('omega-content');
  const alphaButtons = document.querySelectorAll('.alpha-btn');

  // Toggle sidebar
  menuToggle.addEventListener('click', () => {
    const isActive = alpha.classList.toggle('active');
    menuToggle.setAttribute('aria-expanded', String(isActive));
  });

  // Load content dynamically into omega
  function loadIntoOmega(url) {
    fetch(url)
      .then(res => {
        if (!res.ok) throw new Error('Page not found');
        return res.text();
      })
      .then(html => {
        omegaContent.innerHTML = html;

        // Re-execute inline scripts
        const scripts = omegaContent.querySelectorAll('script');
        scripts.forEach(oldScript => {
          const newScript = document.createElement('script');
          if (oldScript.src) newScript.src = oldScript.src;
          else newScript.textContent = oldScript.textContent;
          [...oldScript.attributes].forEach(attr => newScript.setAttribute(attr.name, attr.value));
          oldScript.replaceWith(newScript);
        });
      })
      .catch(err => {
        omegaContent.innerHTML = `<p style="color:red;">Error loading page: ${err.message}</p>`;
      });
  }

  // Handle sidebar nav clicks
  alphaButtons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      const page = btn.getAttribute('data-page');
      loadIntoOmega(page);
    });
  });

  // Optional: close sidebar with Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && alpha.classList.contains('active')) {
      alpha.classList.remove('active');
      menuToggle.setAttribute('aria-expanded', 'false');
    }
  });
</script>

</body>
</html>
